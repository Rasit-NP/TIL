# 2026-02-04

## 🧠 오늘 배운 것
- EC2 Docker 환경 내 MySQL 한글 입력 및 처리

### 문제 상황
- 환경
    - AWS EC2(Ubuntu 24.04)
    - Docker 컨테이너 기반 MySQL 8.4
- 증상
    - 터미널에서 `docker exec`를 통해 MySQL 접속 시, 한글이 포함된 SQL 쿼리를 직접 입력하거나 붙여넣을 때 글자가 유실되거나 정상적으로 입력되지 않음
- 상태 확인
    - 호스트 OS의 `locale`은 `C.UTF-8`로 설정되어 있었음
    - MySQL 접속 시 `--default-character-set=utf8mb4` 옵션을 사용했음에도 장애 발생

### 원인 분석
- 문제의 핵심은 **호스트 OS와 Docker 컨테이너 내부 환경 사이의 '터미널 `locale` 전달 유실**
1. 컨테이너 독립성
    - `docker exec -it` 명령으로 컨테이너 내부 쉘에 접근할 때, 호스트 OS 환경 변수가 자동으로 컨테이너 세션에 완벽히 상속되지 않음
2. 기본 `locale` 부재
    - 많은 Docker 베이스 이미지는 경량화를 위해 기본 `locale`이 `POSIX` 또는 `C`로 설정
    - 이 환경에서는 멀티바이트 문자 처리를 위한 UTF-8 인코딩을 인식하지 못해 입력값 자체가 거부되거나 깨지는 현상이 발생

### 해결 방법
```bash
sudo docker exec -it -e LANG=C.UTF-8 mysql-db mysql -u root - --default-character-set=utf8mb4
```
- `docker exec` 실행 시 환경 변수(`-e`) 옵션을 통해 컨테이너 내부 세션의 `locale`을 강제로 지정함으로써 해결 가능
- `-e LANG=C.UTF-8`
    - 컨테이너 내부에서 실행될 프로세스에 한글 인식이 가능한 UTF-8 환경 변수를 즉시 주입
- `--default-character-set=utf8mb4`
    - MySQL 클라이언트와 서버 간의 통신 인코딩을 `utf8mb4`로 지정

### 검증 및 설정 확인
```SQL
-- 1. 세션 인코딩 강제 설정
SET NAMES 'utf8mb4';

-- 2. 시스템 인코딩 변수 확인
SHOW VARIABLES LIKE 'char%';
```
```
+--------------------------+--------------------------------+
| Variable_name            | Value                          |
+--------------------------+--------------------------------+
| character_set_client     | utf8mb4                        |
| character_set_connection | utf8mb4                        |
| character_set_results    | utf8mb4                        |
+--------------------------+--------------------------------+
```
- 위 지표들이 `utf8mb4`를 가리키고 있다면, 터미널을 통한 한글 데이터 입력 및 조회 준비가 완료된 것

### 결론
- Docker 환경에서 데이터베이스 작업을 수행할 때는 호스트 OS의 설정 뿐만 아니라, **런타임 시 컨테이너 내부로 전달되는 환경 변수(Locale)**를 반드시 점검해야 함
- 특히 한글과 같은 멀티바이트 문자를 다룰 때는 `LANG` 변수 주입이 필수적임