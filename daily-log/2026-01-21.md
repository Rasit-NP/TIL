# 2026-01-21

## 🧠 오늘 배운 것
- Jenkinsfile 작성

### Jenkinsfile
- CI/CD 파이프라인을 코드로 정의한 파일
- Jenkins 대시보드에서 직접 설정하는 대신 소스 코드와 함께 관리함으로써 인프라를 코드로 관리(IaC)할 수 있음

### Jenkinsfile의 두 가지 유형
- **Declarative Pipeline**
    - 더 현대적인 방식으로, 구조가 엄격하며 가독성이 좋음
    - `pipeline` 블록으로 시작함
- **Scripted Pipeline**
    - Groovy 기반의 유연한 방식
    - `node` 블록으로 시작하며 복잡한 로직 구현이 가능하지만, 유지보수가 어려울 수 있음

### Declarative Pipeline 기본 구조
- 파이프라인은 크게 5가지 핵심 섹션으로 구성됨
1. `pipeline`
    - 전체 파이프라인의 시작과 끝을 정의하는 최상위 블럭
2. `agent`
    - 파이프라인이 실행될 환경을 지정
    - `agent any`
        - 사용 가능한 어떤 에이전트에서든 실행
    - `agent { docker { image 'maven:3.8.1-jdk-11' } }`
        - 특정 Docker 이미지 환경에서 실행
3. `stages` & `stage`
    - 파이프라인의 작업 단위(단계)를 나눔
    - `stages`
        - 전체 단계의 묶음
    - `stage('이름')`
        - 빌드, 테스트, 배포 등 개별 단계 정의
4. `steps`
    - 특정 `stage` 안에서 실제로 실행할 명령어들의 집합
        - `sh` : 쉘 스크립트 실행
        - `echo` : 로그 출력
        - `git` : 소스 코드 체크아웃
5. `post`
    - 파이프라인이나 특정 스테이지가 끝난 후 상태(성공, 실패 등)에 따라 실행할 동작을 정의
    - `always` : 성공 여부와 상관없이 항상 실행
    - `success` : 성공 시에만 실행
    - `failure` : 실패 시에만 실행(알림 전송 등에 활용)

### 실전 예시: Spring Boot 빌드 및 배포
```groovy
pipeline {
    agent any

    environment {
        // 환경 변수 설정
        DOCKER_IMAGE = "myapp:${env.BUILD_NUMBER}"
    }

    stages {
        stage('Checkout') {
            steps {
                // 소스 코드 가져오기
                git 'https://github.com/user/repo.git'
            }
        }

        stage('Build') {
            steps {
                // Gradle 빌드
                sh './gradlew clean build'
            }
        }

        stage('Test') {
            steps {
                sh './gradlew test'
            }
        }

        stage('Deploy') {
            steps {
                sh 'docker build -t ${DOCKER_IMAGE} .'
            }
        }
    }

    post {
        success {
            echo '빌드 및 배포에 성공했습니다.'
        }
        failure {
            echo '문제가 발생하여 빌드에 실패했습니다.'
        }
    }
}
```

### 유용한 문법
- **Environment**
    - `environment { ... }` 블록을 사용해 파이프라인 전역에서 사용할 환경 변수를 설정할 수 있음
- **Credentials**
    - 보안이 필요한 정보(비밀번호, API 키)는 `credentials('ID')` 함수를 통해 Jenkins 내부의 Credentials 정보를 안전하게 가져올 수 있음
- **Parameters**
    - 빌드 시 사용자로부터 입력을 받고 싶다면 `parameters { ... }` 블록을 활용