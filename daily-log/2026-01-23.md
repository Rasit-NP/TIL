# 2026-01-23

## 🧠 오늘 배운 것
- Spring Boot 환경별 설정 관리

## Spring Profiles를 활용한 환경 격리
- 애플리케이션은 개발 단계에 따라 서로 다른 인프라(DB, 외부 API 주소, 로그 레벨 등)에 연결됨
- Spring Boot는 **Profile**이라는 개념을 통해 코드의 수정 없이 실행 시점에 설정을 전환할 수 있는 메커니즘을 제공

### 프로파일별 설정 분리
- **공통 설정(`application.properties`)**
    ```properties
    spring.application.name=global-service
    # 기본 활성 프로파일 설정
    spring.profiles.active=local
    spring.jackson.time-zone=Asia/Seoul
    ```
    - 모든 환경에 적용되는 기본값(애플리케이션 이름, 타임존 등)을 정의
- **특화 설정(`application-{env}.properties`)**
    - 특정 환경에서만 유효한 값을 정의하며, 공통 설정보다 우선순위가 높음
    - 로컬 개발 환경(`application-local.properties`)
        ```properties
        server.port=8080
        # 로컬용 DB 주소 (Docker 외부 포트 미지정 시 기본 3306 가정)
        spring.datasource.url=jdbc:mysql://localhost:3306/sandbox_db
        spring.datasource.username=dev_user
        spring.datasource.password=dev_password
        ```
    - 테스트 서버 환경(`application-beta.properties`)
        ```properties
        # 테스트 서버용 DB (Docker 외부 포트 3307 사용 예시)
        spring.datasource.url=jdbc:mysql://${BETA_DB_HOST}:3307/beta_db
        spring.jpa.hibernate.ddl-auto=update
        ```

### 설정의 동적 주입(Environment Variables)
- 설정 파일에 비밀번호나 API 키를 직접 적는 것은 보안상 매우 위험함
- `${VAR_NAME}` 문법을 활용하면, 설정 파일은 틀만 제공하고 실제 값은 실행 환경에서 주입받는 구조를 만들 수 있음
- 소스코드가 유출되어도 인프라 접근 권한은 보호되며, 동일한 빌드 아티팩트를 여러 환경에서 재사용할 수 있음

## JPA와 데이터베이스 스키마 관리 정책
- JPA(Java Persistence API)는 자바 객체와 DB 테이블 간의 동기화 방식을 결정하는 `ddl-auto` 설정을 통해 데이터의 무결성을 관리함

### 단계별 권장 전략
```properties
spring.jpa.hibernate.ddl-auto=update
# SQL 로그 출력
spring.jpa.show-sql=true
# 로그 가독성 향상
spring.jpa.properties.hibernate.format_sql=true
```
- 초기 개발(`create`)
    - 엔티티 수정이 잦으므로 매번 테이블을 밀고 새로 만듦
    - 데이터는 휘발되지만 개발 속도가 빠름
- 기능 검증(`update`)
    - 기존 데이터는 유지하면서 새로운 컬럼만 추가함
    - 팀 단위 테스트 환경에 적합
- 안정화 및 운영(`validate`/`none`)
    - 실제 운영 데이터가 삭제되는 사고를 방지하기 위해, 애플리케이션 구조와 DB 구조가 일치하는지 검사만 하거나 아예 관여하지 않음