# 2025-12-13

## 🧠 오늘 배운 것
- JWT

### JWT
- 사용자 인증 및 정보 전달을 위해 사용되는 압축된 토큰
- 서버가 세션 상태를 보관하지 않아도 되는 **Stateless 인증 방식**을 제공하며, 현대 웹 서비스와 마이크로 서비스 환경에서 널리 사용됨

### JWT의 기본 개념
- JWT는 서버가 사용자를 인증한 뒤, 인증된 사용자임을 증명하는 토큰을 클라이언트에 전달하고, 이후 클라이언트는 요청마다 해당 토큰을 포함해 인증을 수행
- 토큰의 진위 여부는 서버가 가진 비밀키 또는 공개키 기반 서명 검증으로 판단'
- 특징
    - 문자열 기반의 토큰이며, 구조는 `Header.Payload.Signature`로 구성됨
    - 서버는 토큰의 **서명**을 검증하는 것만으로 유효성을 판단할 수 있음
    - 서버는 세션 저장소 없이 인증을 유지할 수 있음

### 토큰 구조
```
xxxxx.yyyyy.zzzzz
```
- JWT는 `.`으로 구분된 세 부분으로 이루어짐
- Header
    - 토큰의 메타 데이터를 담는 부분
    - 주요 필드
        - `alg` : 서명 알고리즘(ex. HS256, RS256)
        - `typ` : 토큰 종류(JWT)
- Payload
    - 인증과 관련된 클레임 정보를 담음
    - 클레임 유형
        - 등록된 클레임(Registered Claims)
            - JWT 표준에서 정의한 항목
            - `iss`(발급자), `sub`(주체), `exp`(만료), `iat`(발급시간), `aud`(대상)
        - 공개 클레임(Public Claims)
            - 서비스에서 정의된 공개 정보
        - 비공개 클레임(Private Claims)
            - 서비스 내부에서 사용하는 임의 필드
- Signature
    - Header와 Payload를 인코딩한 후, 비밀키 또는 개인키로 서명한 값
    - 서명 목적은 **위변조 방지**이며, 토큰 자체를 암호화하는 것은 아님

### 동작 방식
- 로그인 요청
    - 사용자가 ID/Password로 로그인 요청을 보냄
- 서버의 사용자 검증
    - 서버는 DB 등에서 사용자 자격을 검증
- JWT 생성 후 응답
    - 서버는 사용자 정보를 JWT Payload에 포함해 토큰을 생성하고, 클라이언트에게 반환
- 클라이언트 저장
    - 클라이언트는 JWT를 저장
    - 웹 : `localStorage`, `sessionStorage`, `cookie`
    - 모바일 앱 : secure storage
- API 요청 시 토큰 포함
    ```
    Authorization: Bearer <JWT>
    ```
    - 클라이언트는 모든 요청에 헤더를 포함함
- 서버의 토큰 검증
    - 서버는 서명을 검증하고, exp 등 클레임 확인 후 요청을 처리함
    - 이 과정에서 서버는 별도의 세션을 저장할 필요가 없음

### JWT의 장점
- 서버 상태 저장 불필요
    - 세션을 DB나 메모리에 저장하지 않아도 되므로 **확장성**이 우수
- 다양한 서비스 간 인증 공유 용이
    - 마이크로서비스 환경에서 하나의 인증 토큰으로 여러 서비스를 인증할 수 있음
- 속도 우수
    - 검증은 단순한 HMAC/HASH 연산이므로 빠름
- HTTP Header에 쉽게 싣기 가능
    - 문자열 토큰이기 때문에 통신에 적합

### JWT의 단점
- 토큰 무효화 어려움
    - 이미 발급된 JWT는 서버가 강제로 만료시키기 어려움
    - 일반적인 해결 방법
        - 짧은 Access Token + 긴 Refresh Token
        - Blacklist 저장소 운영
- Payload가 암호화되지 않음
    - Base64URL 인코딩일 뿐이며, 누구든 디코딩할 수 있음
    - 따라서 민감한 정보를 포함하면 안됨
- 토큰 길이가 세션 쿠키보다 긺
    - 큰 Payload를 담으면 요청 헤더 크기가 증가해 성능에 영향을 줄 수 있음

### JWT 사용 시 고려사항
- 만료(exp)를 반드시 설정
    - 만료가 없으면 장기 노출 위험이 커짐
- 민감한 정보 금지
    - 비밀번호, 주민등록번호, 금융 정보 등을 넣어서는 안됨
- HTTPS 필수
    - 중간자 공격(MITM) 위험 때문에 HTTPS 환경에서만 사용해야 함
- Refresh Token
    - Access Token 만료 시 새로운 토큰을 발급받기 위한 체계가 필요함