# 2025-10-16

## ğŸ§  ì˜¤ëŠ˜ ë°°ìš´ ê²ƒ
- Django modelì˜ `ForeignKey`ì™€ `ManyToManyField`
- `settings.AUTH_USER_MODEL`ê³¼ `get_user_model`ì˜ ì°¨ì´

## `ForeignKey`ì™€ `ManyToManyField`
### `ForeignKey`
    - í•œ ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ê°€ ë‹¤ë¥¸ ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ë¦¬í‚¤ëŠ” ì™¸ë˜í‚¤
    - ë°ì´í„°ë² ì´ìŠ¤ ê´€ì ì—ì„œëŠ” ìì‹ í…Œì´ë¸”ì— ë¶€ëª¨ì˜ ê¸°ë³¸í‚¤ë¥¼ ì €ì¥í•˜ëŠ” ì»¬ëŸ¼ì´ ìƒê¹€

### `ManyToManyField`
    - ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ê°€ ì„œë¡œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ê°€ì§ˆ ë•Œ ì‚¬ìš©
    - DjangoëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì¤‘ê°„ í…Œì´ë¸”ì„ ìƒì„±í•´ì„œ ë‘ ëª¨ë¸ì˜ PKë¥¼ ì—°ê²°

### ì„ ì–¸ ë°©ë²• ë° ì£¼ìš” ì˜µì…˜
```python
from django.db import models

class Post(models.Model):
    title = models.CharField(max_length=200)

class Comment(models.Model):
    post = models.ForeignKey(Post, on_delete=models.CASCADE, related_name='comments')
    text = models.TextField()

class Author(models.Model):
    name = models.CharField(max_length=100)

class Book(models.Model):
    title = models.CharField(max_length=200)
    authors = models.ManyToManyField(Author, related_name='books', blank=True)
```
- ì£¼ìš” ì˜µì…˜
    - `on_delete`(ForeignKey í•„ìˆ˜)
        - `CASCADE`, `PROTECT`, `SET_NULL`, `SET_DEAFAULT`, `DO_NOTHING`, `RESTRICT`
    - `related_name`
        - ì—­ì°¸ì¡°ìš© ì´ë¦„(ì˜ˆ: `post.comments` ë˜ëŠ” `author.books`)
        - ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ Djangoê°€ ìë™ìœ¼ë¡œ ë§Œë“¦
    - `blank=True`, `null=True`
        - ManyToManyëŠ” DB ì»¬ëŸ¼ì´ ì•„ë‹Œ ë³„ë„ í…Œì´ë¸”ì´ë¯€ë¡œ `null=True`ëŠ” ì˜ë¯¸ê°€ ì—†ìŒ
        - `blank=True`ëŠ” í¼/ê´€ë¦¬ìì—ì„œ ë¹ˆ ê°’ í—ˆìš©
    - `through`
        - ManyToManyì˜ ì¤‘ê°„ ëª¨ë¸ì„ ì§ì ‘ ì§€ì •í•´ **ì¶”ê°€ í•„ë“œ**ë¥¼ ì €ì¥í•  ìˆ˜ ìˆìŒ
    - `symmetrical`
        - ìê¸°ìì‹ ê³¼ì˜ ManyToManyì—ì„œ ëŒ€ì¹­ì„±ì„ ì œì–´
            - ì˜ˆ) ì¹œêµ¬ ê´€ê³„ ë“±

### DB ìŠ¤í‚¤ë§ˆ ê´€ì 
- ForeignKey
    - ìì‹ í…Œì´ë¸”ì— `parent_id` ì»¬ëŸ¼ ìƒì„±
    - SQLì—ì„œëŠ” JOINìœ¼ë¡œ ì²˜ë¦¬
- ManyToMany
    - DjangoëŠ” ìë™ìœ¼ë¡œ ì¤‘ê°„ í…Œì´ë¸”ì„ ìƒì„±
    - ì´ í…Œì´ë¸”ì€ ë‘ FK ì»¬ëŸ¼ê³¼ ì¸ë±ìŠ¤ë¥¼ ê°€ì§
    - `through` ì‚¬ìš© ì‹œ ì¤‘ê°„ í…Œì´ë¸”ì„ ì§ì ‘ ì •ì˜

### ì—­ì°¸ì¡° ì‚¬ìš©
- ForeignKey ì—­ì°¸ì¡°
    ```python
    post = Post.objects.get(pk=1)
    comments = post.comments.all()      # related_name='comments' ì‚¬ìš© ì‹œ
    ```
- ManyToMany ì—­ì°¸ì¡°
    ```python
    book = Book.objects.get(pk=1)
    authors = book.authors.all()
    author.books.all()      # ì—­ì°¸ì¡°
    ```

### ManyToMany ì¡°ì‘ API
- ì¶”ê°€/ì‚­ì œ/ì„¤ì •
    ```python
    book.authors.add(author_instance)
    book.authors.remove(author_instance)
    book.authors.set([a1, a2])  # ê¸°ì¡´ ê´€ê³„ë¥¼ ì´ ë¦¬ìŠ¤íŠ¸ë¡œ ëŒ€ì²´
    book.authors.clear()
    ```
- `through`ê°€ ìˆëŠ” ê²½ìš°ëŠ” ì§ì ‘ ì¤‘ê°„ ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì €ì¥í•˜ê±°ë‚˜
- `through` ëª¨ë¸ì—ì„œ `objects.create(...)`ë¡œ ìƒì„±í•´ì•¼í•¨
    - ìë™ `add()`ëŠ” ë¶ˆê°€í•˜ê±°ë‚˜ ì œí•œë¨

### ì¤‘ê°„ ëª¨ë¸(through)ì˜ ì‚¬ìš© ì˜ˆ
```python
class Membership(models.Model):
    person = models.ForeignKey(Person, on_delete=models.CASCADE)
    group = models.ForeignKey(Group, on_delete=models.CASECADE)
    date_joined = models.DateField()
    role = models.CharField(max_length=50)

class Group(models.Model):
    memebers = models.ManyToManyField(Person, through='Membership')
```

### ì œì•½$\cdot$ìœ ì˜ì‚¬í•­
- `on_delete=CASCADE`ëŠ” ë¶€ëª¨ ì‚­ì œ ì‹œ ìì‹ë„ ì‚­ì œë¨
    - ë°ì´í„° ì†ì‹¤ ì£¼ì˜
    - ë³´ìˆ˜ì ìœ¼ë¡œ `PROTECT`ë‚˜ `RESTRICT` ê³ ë ¤
- `related_name`ë¥¼ ì˜ ì •ì˜í•˜ë©´ ì½”ë“œ ê°€ë…ì„±$\uparrow$, ì¶©ëŒ ë°©ì§€
- ManyToManyì˜ ëŒ€ëŸ‰ ë³€ê²½ ì‹œ `add()`ë¥¼ ë°˜ë³µ í˜¸ì¶œí•˜ë©´ ë¹„íš¨ìœ¨ì 
    - ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ëŠ” `set()`ì´ë‚˜ bulk ì—°ì‚° ê³ ë ¤
- `null=True`ëŠ” ForeignKeyì—ë§Œ ì˜ë¯¸ ìˆìŒ
    - ManyToManyì—ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
- DB ìˆ˜ì¤€ì˜ unique/constraint ì„¤ì •ì€ í•„ìš”í•˜ë©´ ì¤‘ê°„ ëª¨ë¸ì—ì„œ ì •ì˜

### ë§ˆì´ê·¸ë ˆì´ì…˜ & ê´€ë¦¬
- ëª¨ë¸ ë³€ê²½ í›„ `makemigrations`/`migrate` ìˆ˜í–‰
    - ManyToMany í•„ë“œ ì¶”ê°€ëŠ” ë³„ë„ì˜ ì¤‘ê°„ í…Œì´ë¸” ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
- Django Adminì—ì„œ ManyToManyëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì„ íƒ ìœ„ì ¯(ë˜ëŠ” ì¸ë¼ì¸ `through` ëª¨ë¸)ìœ¼ë¡œ ê´€ë¦¬
    - ëŒ€í˜• í…Œì´ë¸”ì€ ì„±ëŠ¥/ì‚¬ìš©ì„± ê³ ë ¤(ìˆ˜ë™ ê²€ìƒ‰ ìœ„ì ¯, `raw_id_fields` ë“±)

### ì˜ˆì œ ìƒí™©ë³„ ì¶”ì²œ
- ê²Œì‹œê¸€-ì‘ì„±ì
    - `ForeignKey(User)`
- íƒœê·¸-ê²Œì‹œê¸€
    - `ManyToMany(Tag)`
- íŒ€-ì‚¬ìš©ì
    - `ManyToMany through=Membership`
- í”„ë¡œí•„-ì‚¬ìš©ì
    - `OneToOneField`

### íŠ¸ëœì­ì…˜ê³¼ ë™ì‹œì„±
- ê´€ê³„ë¥¼ ë³€ê²½í•  ë•Œ ì—¬ëŸ¬ ì¿¼ë¦¬ê°€ ë°œìƒí•˜ë©´ `transaction.atomic()`ìœ¼ë¡œ ë¬¶ì–´ ì›ìì„± ë³´ì¥ ê¶Œì¥
- ë™ì‹œì„± ë¬¸ì œëŠ” DB ì œì•½ ë° ì½”ë“œ ë ˆë²¨ì—ì„œ ì²˜ë¦¬ í•„ìš”


## `settings.AUTH_USER_MODEL` vs. `get_user_model()`

### ë‘ ë°©ì‹ì˜ ì°¨ì´
| êµ¬ë¶„       | `settings.AUTH_USER_MODEL`                     | `get_user_model()`|
| -------- | ---------------------------------------------- | ------------------------------------------ |
| í˜•íƒœ       | ë¬¸ìì—´ (`'accounts.User'`)                        | ì‹¤ì œ User í´ë˜ìŠ¤ ê°ì²´|
| ì‚¬ìš© ì‹œì     | **ëª¨ë¸ ì •ì˜í•  ë•Œ (import ì‹œì )**                       | **ì‹¤í–‰ ì‹œì  (runtime)**|
| ì£¼ë¡œ ì‚¬ìš© ìœ„ì¹˜ | `models.py`, `ForeignKey`, `ManyToManyField` ë“± | `views.py`, `serializers.py`, `forms.py` ë“±|
| ì˜ˆì‹œ       | `ForeignKey(settings.AUTH_USER_MODEL, ...)`    | `User = get_user_model()` í›„ ì‚¬ìš©|

### ëª¨ë¸ì—ì„œëŠ” `settings.AUTH_USER_MODEL`ì„ ì¨ì•¼ í•˜ëŠ” ì´ìœ 
- `models.py`ëŠ” Djangoê°€ ì•±ì„ ë¡œë“œí•  ë•Œ ê°€ì¥ ë¨¼ì € importí•¨
    - ì´ ì‹œì ì—ì„œëŠ” User ëª¨ë¸ì´ ì•„ì§ ì™„ì „íˆ ë¡œë“œë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŒ
- `get_user_model()`ì€ ë‚´ë¶€ì ìœ¼ë¡œ `django.contrib.auth.get_user_model()`ì„ í†µí•´ **ì´ë¯¸ ë“±ë¡ëœ User ëª¨ë¸ í´ë˜ìŠ¤ë¥¼ ë°˜í™˜**í•˜ëŠ”ë°
    - ì´ í˜¸ì¶œì´ ë„ˆë¬´ ì¼ì° ì¼ì–´ë‚˜ë©´ ì•„ì§ `User` í´ë˜ìŠ¤ê°€ ë“±ë¡ë˜ì§€ ì•Šì€ ìƒíƒœì¼ ìˆ˜ ìˆìŒ

### ê¶Œì¥ë˜ëŠ” ì˜¬ë°”ë¥¸ ë°©ë²•
- Django ê³µì‹ ë¬¸ì„œì—ì„œë„ ì•„ë˜ë¥¼ ê¶Œì¥
> Use `settings.AUTH_USER_MODEL` for model fields.$\\$
Use `get_user_model()` for runtime access to the user model.

### `get_user_model()`ì˜ ì‚¬ìš©
- **ì‹¤ì œ ì½”ë“œ ì‹¤í–‰ ì¤‘ì— User ëª¨ë¸ì´ í•„ìš”í•  ë•Œ** ì‚¬ìš©
    - views, serializers, commands, forms ë“±ì—ì„œ ì‚¬ìš© ê°€ëŠ¥